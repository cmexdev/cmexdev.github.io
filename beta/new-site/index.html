<!DOCTYPE html>
<html>
    <head>
        <title>The Piccolowen Hub</title>
        <link href="../../src/pageicon.png" rel="icon">
        <link href="index.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="../../src/jquery-3.5.1.js"></script>
        <!--OPTIONAL STYLING
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        -->
    </head>
    <body>
        <div id="logo">
            <span id="logo-title">The Piccolowen Hub</span>
            -
            <span class="services" id="logo-link"><a title="Services" href="services.html">Services</a></span>
            -
            <span id="logo-link"><a title="About" href="">About</a></span>
            -
            <span id="logo-link"><a title="Contact" href="">Contact</a></span>

            <span id="login-nav"><a title="Login" href="login.html">Login</a></span>
        </div>

        <div id="welcome">
            <span class="welcome-title">Welcome to the new Piccolowen hub!</span>
            
            <span class="welcome-desc">Switching to proper grammar and capatilization was hard.</span>
        </div>

        <hr>

        <div id="content">
            <noscript>
                <div class="noscript">
                    Don't see anything?
                    <span class="noscript-try">Try turning on JavaScript</span>
                    <span class="noscript-y"><code>piccolowen.github.io</code> highly recommends using JavaScript for this site and lots other. Most features will not work without JavaScript.</span>
                </div>
                <hr>
            </noscript>
            <!--CONTENT ONLY LOADED IF JAVASCRIPT IS ENABLED-->
            <div id="news">
                <span id="news-in"></span>
                <script src="news.js"></script>
                <hr />
            </div>
        </div>

        <div id="footer">
            <div class="table">
                <table>
                    <tr>
                        <th>Resources</th>
                        <th>Privacy</th>
                    </tr>
                    <tr>
                        <td><a class="tbl-link" target="_blank" href="https://github.com/Piccolowen/piccolowen.github.io">GitHub repository</a></td>
                        <td><a class="tbl-link" href="privacy/summary.html">Summary</a></td>
                    </tr>
                    <tr>
                        <td><a class="tbl-link" href="https://getbootstrap.com/">Bootstrap</a></td>
                        <td><a class="tbl-link" href="">Cookies</a> (404)</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><a href="" class="tbl-link">Location</a> (404)</td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="cookie-alert">
            <span id="cookie-alert-content"><code>piccolowen.github.io</code> uses Cookies to store data. <a id="cookie-alert-content-a" onclick="closeCookie()">Sounds good!</a></span>
            <script>
                //FIRST VISIT 1 MEANS FIRST VISIT IS TRUE
                //FIRST VISIT 0 MEANS NOT TRUE
                function closeCookie() {
                    document.getElementById('cookie-alert').style.display = 'none'
                    document.cookie = 'firstVisit=0'
                }
                window.onload = checkCookie()
                function checkCookie() {
                    if (document.cookie == 'firstVisit=1') {
                        document.getElementById('cookie-alert').style.display = 'block'
                    }
                    else {
                        document.getElementById('cookie-alert').style.display = 'none'
                    }
                }
            </script>
        </div>
        <div>
            <script>
                var username = ''
                var fullusername = ''
                var usernum = ''
                var userimg = ''

                window.onload = () => {
                    const fragment = new URLSearchParams(window.location.hash.slice(1))

                    if (fragment.has('access_token')) {
                        const accessToken = fragment.get('access_token')
                        const tokenType = fragment.get('token_type')

                        fetch('https://discord.com/api/users/@me', {
                            headers: {
                                authorization: `${tokenType} ${accessToken}`
                            }
                        })
                            .then(res => res.json())
                            .then(response => {
                                username = response.username
                                fullusername = response.username + '#' + response.discriminator
                                usernum = response.id
                                userimg = 'https://cdn.discordapp.com/avatars/' + response.id + '/' + response.avatar + '.png'

                                //STORE IN COOKIES
                                document.cookie = 'userid=' + response.id
                                document.cookie = 'username=' + fullusername
                                document.cookie = 'userimg=' + userimg

                                var loginOut = document.getElementById('login-nav')
                                loginOut.textContent = ''
                                loginOut.style.float = 'none'

                                var loginImg = document.createElement('img')
                                loginImg.src = userimg
                                loginImg.style.width = '50px'
                                loginImg.style.border = 'gold solid'
                                loginImg.style.borderRadius = '50%'
                                loginOut.appendChild(loginImg)

                                var loginName = document.createElement('span')
                                loginName.textContent = username
                                loginName.style.fontSize = '20px'
                                loginOut.appendChild(loginName)
                            })
                            .catch(console.error)
                    }
                }
            </script>
        </div>
    </body>
    <div id="style">
        <style>
            html {
                padding: 10px;
            }
        </style>
    </div>
</html>