<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>discord auth</title>
</head>
<body>
    <div id="info">
        Hoi!
    </div>
    <img id="userImg">
    <span id="userName"></span>
    <span id="userEmail"></span>
    <a id="login" style="display: none;" href="https://discord.com/api/oauth2/authorize?client_id=671823085695139840&redirect_uri=http%3A%2F%2Flocalhost%3A53134%2F&response_type=token&scope=identify%20email%20connections%20rpc">Login with Discord</a>
    <script>
        //const client = new Discord.Client()
        var username = ''
        var userid = ''
        var useremail = ''
        var userimg = ''

        window.onload = () => {
                const fragment = new URLSearchParams(window.location.hash.slice(1));

                if (fragment.has("access_token")) {
                    const accessToken = fragment.get("access_token");
                    const tokenType = fragment.get("token_type");

                    fetch('https://discordapp.com/api/users/@me', {
                        headers: {
                            authorization: `${tokenType} ${accessToken}`
                        }
                    })
                        .then(res => res.json())
                        .then(response => {
                            console.log(response)
                            document.cookie = 'username=' + response.username + '#' + response.discriminator
                            document.cookie = 'userid=' + response.id
                            console.log(document.cookie)

                            username = response.username + '#' + response.discriminator
                            userid = response.id
                            useremail = response.email
                            userimg = 'https://cdn.discordapp.com/avatars/' + userid + '/' + response.avatar + '.png'

                            document.getElementById('userImg').src = userimg
                            document.getElementById('userName').textContent = username
                            document.getElementById('userEmail').textContent = useremail
                        })
                        .catch(console.error);

                }
                else {
                    document.getElementById('login').style.display = 'block';
                }
            }
    </script>
    <script src="di.js">
        const client = new Discord.Client();

            client.on('message', msg => {
                const guildTag = msg.channel.type === 'text' ? `[${msg.guild.name}]` : '[DM]';
                const channelTag = msg.channel.type === 'text' ? `[#${msg.channel.name}]` : '';
                console.log(`${guildTag}${channelTag} ${msg.author.tag}: ${msg.content}`);
            });

            client.login('671823085695139840');
    </script>
</body>
</html>