<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>The Piccolowen Hub</title>
        <link href="src/img/pageicon.png" rel="icon">
        <link href="index.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="src/js/jquery-3.5.1.js"></script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163374942-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'UA-163374942-1');
        </script>
    </head>
    <body>
        <div id="logo">
            <span id="logo-title">The Piccolowen Hub</span>
            -
            <span class="services" id="logo-link"><a title="Services" href="services.html">Services</a></span>
            <span id="logo-link"><a title="About" href=""></a></span>
            <span id="logo-link"><a title="Contact" href=""></a></span>

            <!--<span id="login-nav"><a title="Login" href="login.html">Login</a></span>-->
        </div>

        <div id="welcome">
            <span class="welcome-title">Welcome to the new Piccolowen hub!</span>
            
            <span class="welcome-desc">Switching to proper grammar and capatilization was hard.</span>
        </div>

        <hr>

        <div id="content">
            <noscript>
                <div class="noscript">
                    Don't see anything?
                    <span class="noscript-try">Try turning on JavaScript</span>
                    <span class="noscript-y"><code>piccolowen.github.io</code> highly recommends using JavaScript for this site and lots other. Most features will not work without JavaScript.</span>
                </div>
                <hr>
            </noscript>
            <!--CONTENT ONLY LOADED IF JAVASCRIPT IS ENABLED-->
            <div id="news">
                <span id="news-in"></span>
                <script src="news.js"></script>
                <hr>
            </div>
        </div>

        <div id="footer-table">

        </div>
        <script src="src/js/footer.js" type="text/javascript"></script>

        <hr>

        <div>
            <p id="browser-details">Browser details unavailable.</p>
            <script>
                document.getElementById('browser-details').innerHTML = 'Browser details | Screen height: <b>' + window.screen.height + '</b>. Screen width: <b>' + window.screen.width + '</b>. Orientation: <b>' + window.screen.orientation.type + '</b> (' + window.screen.orientation.angle + ' angle). Navigator code name: <b>' + window.navigator.appCodeName + '</b>. Navigator app name: <b>' + window.navigator.appName + '</b>. Navigator language: <b>' + window.navigator.language + '</b>. Navigator status (online): <b>' + window.navigator.onLine + '</b>. Navigator platform: <b>' + window.navigator.platform + '</b>. Navigator user agent: <b>' + window.navigator.userAgent + '</b>. Navigator vendor: <b>' + window.navigator.vendor + '</b>.'
            </script>
            <p id="doc-details">Document details unavailable.</p>
            <script>
                document.getElementById('doc-details').innerHTML = 'Document details | Document URL: <b>' + 'REMOVED' + '</b>. Document charset: <b>' + document.charset + '</b>. Base domain: <b>' + document.domain + '</b>. Document title: <b>' + document.title + '</b>.'
            </script>
            <p id="date">Date unavailable.</p>
            <script>
                document.getElementById('date').innerHTML = 'Date: <b>' + new Date() + '</b>'
            </script>
        </div>

        <div id="cookie-alert">
            <span id="cookie-alert-content"><code>piccolowen.github.io</code> uses Cookies to store data. <a id="cookie-alert-content-a" onclick="closeCookie()">Sounds good!</a></span>
            <script>
                //FIRST VISIT 1 MEANS FIRST VISIT IS TRUE
                //FIRST VISIT 0 MEANS NOT TRUE
                function closeCookie() {
                    document.getElementById('cookie-alert').style.display = 'none'
                    document.cookie = 'firstVisit=0'
                }
                window.onload = checkCookie()
                function checkCookie() {
                    if (document.cookie == 'firstVisit=1') {
                        document.getElementById('cookie-alert').style.display = 'block'
                    }
                    else {
                        document.getElementById('cookie-alert').style.display = 'none'
                    }
                }
            </script>
        </div>
        <div>
            <script>
                var username = ''
                var fullusername = ''
                var usernum = ''
                var userimg = ''
                
                window.onload = () => {
                    const fragment = new URLSearchParams(window.location.hash.slice(1))

                    if (fragment.has('access_token')) {
                        const accessToken = fragment.get('access_token')
                        const tokenType = fragment.get('token_type')

                        fetch('https://discord.com/api/users/@me', {
                            headers: {
                                authorization: `${tokenType} ${accessToken}`
                            }
                        })
                            .then(res => res.json())
                            .then(response => {
                                username = response.username
                                fullusername = response.username + '#' + response.discriminator
                                usernum = response.id
                                userimg = 'https://cdn.discordapp.com/avatars/' + response.id + '/' + response.avatar + '.png'

                                //STORE IN COOKIES
                                document.cookie = 'userid=' + response.id
                                document.cookie = 'username=' + fullusername
                                document.cookie = 'userimg=' + userimg

                                var loginOut = document.getElementById('login-nav')
                                loginOut.textContent = ''
                                loginOut.style.float = 'none'

                                var loginImg = document.createElement('img')
                                loginImg.src = userimg
                                loginImg.style.float = 'right'
                                loginImg.style.width = '50px'
                                loginImg.style.border = 'gold solid'
                                loginImg.style.borderRadius = '50%'
                                loginOut.appendChild(loginImg)

                                var loginName = document.createElement('span')
                                loginName.textContent = username
                                loginName.style.fontSize = '20px'
                                loginName.style.float = 'right'
                                loginOut.appendChild(loginName)
                            })
                            .catch(console.error)
                    }
                }
            </script>
        </div>
    </body>
    <div id="style">
        <style>
            html {
                padding: 10px;
            }
        </style>
    </div>
</html>